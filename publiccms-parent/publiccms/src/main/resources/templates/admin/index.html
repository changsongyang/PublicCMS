<!DOCTYPE html>
<html lang="<@t.page 'html_lang'/>">
<head>
    <meta charset="utf-8">
    <title>${site.name} - <@t.page 'management_system'/></title>
    <meta name="viewport" content="width=device-width,initial-scale=0.6">
    <link href="${base}/resource/plugins/codemirror/lib/codemirror.css" rel="stylesheet"/>
    <link href="${base}/resource/plugins/codemirror/addon/hint/show-hint.css" rel="stylesheet"/>
    <link href="${base}/resource/fonts/font-awesome/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="${base}/resource/fonts/bootstrap-icons/bootstrap-icons.css" rel="stylesheet"/>
    <link href="${base}/resource/plugins/spectrum/spectrum.min.css" rel="stylesheet"/>
    <link href="${base}/resource/css/core.css?version=202205" rel="stylesheet" media="screen"/>
    <link href="${base}/resource/css/print.css" rel="stylesheet" media="print"/>
    <link href="${base}/resource/css/cms.css?version=202205" rel="stylesheet" media="screen"/>
    <script src="${base}/resource/js/echarts.proxy.js"></script>
</head>
<body>
    <header>
        <a class="logo" href="./"><img src="<#if siteAttribute.logo?has_content>${getAbsoluteUrl(site.sitePath,siteAttribute.logo)}<#else>${base}/resource/logo.png</#if>" alt="LOGO"/></a>
        <ul class="nav">
            <@sys.authorized roleIds=admin.roles url='cmsDiy/preview'>
            <li><a href="cmsDiy/preview.html" target="navTab" rel="cmsDiy/preview"><i class='bi bi-palette2'></i> <@t.page 'diy.preview'/></a></li>
            </@sys.authorized>
            <li><a href="${site.dynamicPath!}" target="_blank"><i class="icon-home icon-large"></i></a></li>
        <#if site.useStatic>
            <li><a href="${site.sitePath!}" target="_blank"><@t.page 'website'/></a></li>
        </#if>
        <@sys.authorized roleIds=admin.roles url='clearCache'>
            <li>
                <a href="clearCache" target="ajaxTodo" title="<@t.page 'button.clear_cache'/>"><i class="icon-rubbish icon-large"></i></a>
            </li>
        </@sys.authorized>
            <li>
                <a href="javascript:"><i class="icon-user icon-large"></i> ${(admin.nickname)!}</a>
            </li>
            <li>
                <a href="logout?userId=${admin.id}" title="<@t.page 'logout'/>"><i class="icon-signout icon-large"></i></a>
            </li>
        </ul>
        <ul id="navMenu">
            <li>
                <a href="javascript:;" onclick="return false;" class="toggleCollapse"><i class="icon icon-chevron-sign-left icon-large"></i></a>
            </li>
    <@sys.moduleList>
        <#list page.list as a>
            <@t.merge 'moduleIds' a.id!/>
        </#list>
        <@sys.roleModule roleIds=admin.roles moduleIds=t.moduleIds!><#assign roleModuleMap=map!/></@sys.roleModule>

        <#list page.list as a>
            <#if (roleModuleMap[a.id?string])?has_content&&roleModuleMap[a.id?string]>
                <#if !parentId?has_content><#assign parentId=a.id/></#if>
                <li>
                    <a href="${a.url?has_content?then(a.url,'menus.html?parentId='+a.id)}" parentId="${a.id}"><#if (a.attached)?has_content><i class="${a.attached} icon-large"></i></#if> <@t.menu a.id/></a>
                </li>
            </#if>
        </#list>
    </@sys.moduleList>
    <@tools.masterSite>
        <@sys.authorized roleIds=admin.roles url='sysSite/menu'>
            <li>
                <a href="sysSite/menu.html" parentId="site"><i class="icon-sitemap icon-large"></i><@t.menu 'site'/></a>
            </li>
        </@sys.authorized>
    </@tools.masterSite>
        </ul>
    </header>
    <main>
        <div id="leftside">
            <div id="sidebar_s"><i class="icon-reorder icon-large"></i></div>
            <div id="sidebar">
                <div id="menu">
                    <#include "menus.html"/>
                </div>
            </div>
        </div>
        <div id="navTab" class="tabsPage">
            <div class="tabsPageHeader">
                <div class="tabsPageHeaderContent">
                    <ul class="navTab-tab">
                        <li tabid="main" class="main" url="main.html"><a href="javascript:;" onclick="return false;"><i class="icon-home icon-large"></i><@t.page 'workgin_table'/></a></li>
                    </ul>
                </div>
                <a href="javascript:;" onclick="return false;" class="tabsLeft"><i class="icon-backward icon-large"></i></a>
                <a href="javascript:;" onclick="return false;" class="tabsRight"><i class="icon-forward icon-large"></i></a>
                <a href="javascript:;" onclick="return false;" class="tabsMore"><i class="icon-th-list icon-large"></i></a>
            </div>
            <ul class="tabsMoreList">
                <li><a href="javascript:;" onclick="return false;"><i class="icon-home icon-large"></i><@t.page 'workgin_table'/></a></li>
            </ul>
            <div class="navTab-panel tabsPageContent layoutBox">
                <div class="page unitBox work-bench">
                    <#include "main.html"/>
                </div>
            </div>
        </div>
    </main>
    <footer>
       <ul class="langList">
        <#list langs as k,v>
            <li<#if springMacroRequestContext.getMessage('page.lang')=k> class="current-lang"</#if>>
                <a href="changeLocale?lang=${k}" target="ajaxTodo">
                    <img src="${base}/resource/images/${k}.png" alt="${v}"/>${v}
                </a>
            </li>
        </#list>
        </ul>
    <@tools.version>
        <#if authorizationEdition>
            <a href="common/license.html" target="dialog" mask="true"><@t.page 'license'/>: ${getLicense().authorization!}</a>
        <#else>
            <@t.page 'license.no'/>
            <@tools.masterSite>
                <@sys.authorized roleIds=admin.roles url='sysSite/uploadLicense'>
            <a href="sysSite/uploadLicense.html" target="navTab" rel="sysSite/uploadLicense" icon="<i class='icon-archive icon-large'></i>" title="<@t.menu 'license'/>"><@t.page 'license.upgrade'/></a>
                </@sys.authorized>
            </@tools.masterSite>
        </#if>
    </@tools.version>
        Copyright &copy; ${.now?string('yyyy')}
        <ul class="themeList" id="themeList">
            <li theme="toptry"><div></div></li>
            <li theme="red"><div></div></li>
        </ul>
    </footer>
    <script src="${base}/resource/js/jquery-3.6.0.min.js"></script>
    <script src="${base}/resource/js/jquery.cookie.js"></script>
    <script src="${base}/resource/js/jquery.validate.js"></script>
    <script src="${base}/resource/js/base64.js"></script>
    <script src="${base}/resource/js/sha512.min.js"></script>
    <script src="${base}/resource/js/dwz.min.js?version=20220524"></script>
    <script src="${base}/resource/js/loadscripts.js"></script>
    <script src="${base}/resource/plugins/spectrum/spectrum.min.js"></script>
    <script src="${base}/resource/plugins/spectrum/<@t.page 'spectrum.lang_js'/>"></script>
    <script src="${base}/resource/js/dwz.plugins.js?version=202205"></script>
    <script src="${base}/resource/js/<@t.page 'dwz_regional_js'/>"></script>
    <script src="${base}/resource/js/cms.js?version=202205"></script>
    <script>
        var base="${base+adminContextPath}";
        window.UEDITOR_HOME_URL="${(parentSite!site).dynamicPath}resource/plugins/ueditor/";
        window.CKEDITOR_BASEPATH="${(parentSite!site).dynamicPath}resource/plugins/ckeditor/";
        window.CKEDITOR_LANGUAGE="<@t.page 'ckeditor.lang'/>";
        window.KINDEDITOR_OPTIONS = {
                width:'60%',
                height:'400px',
                basePath:'${(parentSite!site).dynamicPath}resource/plugins/kindeditor/',
                uploadJson : '${base+adminContextPath}/kindeditor/upload',
                fileManagerJson : '${base+adminContextPath}/cmsWebFile/fileList.html',
                allowFileManager : true,
                formatUploadUrl : false
        };
        window.TINYMCE_OPTIONS = {
            language:'<@t.page 'tinymce.lang'/>',
            base_url:'${(parentSite!site).dynamicPath}resource/plugins/tinymce/',
            plugins: 'preview importcss searchreplace autolink autosave save directionality code visualblocks visualchars fullscreen image link media template codesample table charmap pagebreak nonbreaking anchor insertdatetime advlist lists wordcount help charmap quickbars emoticons',
            editimage_cors_hosts: ['picsum.photos'],
            menubar: 'file edit view insert format tools table help',
            toolbar: 'undo redo | bold italic underline strikethrough | fontfamily fontsize blocks | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor backcolor removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media template link anchor codesample | ltr rtl',
            toolbar_sticky: true,
            toolbar_sticky_offset: 108,
            autosave_ask_before_unload: true,
            autosave_interval: '30s',
            autosave_prefix: '{path}{query}-{id}-',
            autosave_restore_when_empty: false,
            autosave_retention: '2m',
            pagebreak_split_block: true,
            image_advtab: true,
            importcss_append: true,
            images_upload_url: '${base+adminContextPath}/tinymce/upload',
            images_reuse_filename: true,
            images_upload_base_path: '${site.sitePath}',
            image_list: '${base+adminContextPath}/tinymce/imageList',
            image_prepend_url:"${site.sitePath}",
            file_picker_callback: function (callback, value, meta) {
                var filetype='<@sys.configData code="site">${object.allow_files!}</@sys.configData>';
                switch(meta.filetype){
                    case 'image':
                        filetype='.png,.jpg,.jpeg,.gif,.bmp';
                        break;
                    case 'media':
                        filetype='.mp3, .mp4, .wmv, .mid,.flv,.swf,.mkv,.avi,.rm,.rmvb,.mpeg,.mpg,.ogg,.ogv,.mov';
                        break;
                    case 'file':
                    default:
                }
                var input = document.createElement('input');
                    input.setAttribute('type', 'file');
                    input.setAttribute('accept', filetype);
                input.click();
                input.onchange = function() {
                    var file = this.files[0];
                    var xhr, formData;
                    xhr = new XMLHttpRequest();
                    xhr.withCredentials = false;
                    xhr.open('POST', '${base+adminContextPath}/tinymce/upload');
                    xhr.onload = function() {
                        var json;
                        if (xhr.status != 200) {
                            alertMsg.error('HTTP Error: ' + xhr.status);
                            return;
                        }
                        json = JSON.parse(xhr.responseText);
                        if (!json || typeof json.location != 'string') {
                            alertMsg.error('Invalid JSON: ' + xhr.responseText);
                            return;
                        }
                        callback('${site.sitePath}'+json.location);
                    };
                    formData = new FormData();
                    formData.append('file', file, file.name );
                    xhr.send(formData);
              };
          },
          templates: [
            { title: 'New Table', description: 'creates a new table', content: '<div class="mceTmpl"><table width="98%%"  border="0" cellspacing="0" cellpadding="0"><tr><th scope="col"> </th><th scope="col"> </th></tr><tr><td> </td><td> </td></tr></table></div>' },
            { title: 'Starting my story', description: 'A cure for writers block', content: 'Once upon a time...' },
            { title: 'New list with dates', description: 'New List with dates', content: '<div class="mceTmpl"><span class="cdate">cdate</span><br><span class="mdate">mdate</span><h2>My List</h2><ul><li></li><li></li></ul></div>' }
          ],
          template_cdate_format: '[Date Created (CDATE): %m/%d/%Y : %H:%M:%S]',
          template_mdate_format: '[Date Modified (MDATE): %m/%d/%Y : %H:%M:%S]',
          height: 600,
          image_caption: true,
          quickbars_selection_toolbar: 'bold italic | quicklink h2 h3 blockquote quickimage quicktable',
          noneditable_class: 'mceNonEditable',
          toolbar_mode: 'wrap',
          contextmenu: 'link image table',
          skin: 'oxide',
          content_css: 'default',
        };
        window.editor = {
            ckeditorResources: ["${base}/resource/plugins/ckeditor/ckeditor.js"],
            ueditorResources: ["${base}/resource/plugins/ueditor/ueditor.config.js","${base}/resource/plugins/ueditor/ueditor.all.min.js","${base}/resource/plugins/ueditor/lang/<@t.page 'ueditor.lang_js'/>"],
            tinymceResources: ["${base}/resource/plugins/tinymce/tinymce.min.js"],
            kindeditorResources: ["${base}/resource/plugins/kindeditor/kindeditor-all-min.js","${base}/resource/plugins/kindeditor/<@t.page 'kindeditor.lang_js'/>"],
            ckeditorInitd: false,
            ueditorInitd: false,
            kindeditorInitd: false,
            index: 0
        };
        window.codemirror = {
            resources: ['${base}/resource/plugins/codemirror/lib/codemirror.js','${base}/resource/plugins/codemirror/mode/xml/xml.js','${base}/resource/plugins/codemirror/mode/javascript/javascript.js','${base}/resource/plugins/codemirror/mode/css/css.js',
                '${base}/resource/plugins/codemirror/mode/htmlmixed/htmlmixed.js','${base}/resource/plugins/codemirror/mode/freemarker/freemarker.js','${base}/resource/plugins/codemirror/mode/freemarkermixed/freemarkermixed.js',
                '${base}/resource/plugins/codemirror/mode/nginx/nginx.js','${base}/resource/plugins/codemirror/addon/hint/show-hint.js','${base}/resource/plugins/codemirror/addon/hint/javascript-hint.js','${base}/resource/plugins/codemirror/addon/hint/html-hint.js',
                '${base}/resource/plugins/codemirror/addon/hint/css-hint.js','${base}/resource/plugins/codemirror/addon/hint/xml-hint.js'],
            initd: false,
            index: 0
        };
        window.photoclip = {
            resources: ['${base}/resource/plugins/photoclip/hammer.min.js','${base}/resource/plugins/photoclip/iscroll-zoom-min.js','${base}/resource/plugins/photoclip/lrz.all.bundle.js','${base}/resource/plugins/photoclip/PhotoClip.min.js'],
            initd: false,
            index: 0
        };
        DWZ.init("${base+adminContextPath}/common/dwz.frag.html", {
            loginUrl:"login_dialog.html", loginTitle:"<@t.page 'login'/>",
            pageInfo:{pageNum:"pageNum", numPerPage:"numPerPage", orderField:"orderField", orderDirection:"orderType"},
            debug:false,
            callback:function(){
                initEnv();
                $("#themeList").theme({themeBase:"${base}/resource/css/theme-",defaultTheme:"toptry"});
            <#if admin.weakPassword && admin.loginCount lte 3 >
                <@sys.authorized roleIds=admin.roles url='changePassword'>
                $.pdialog.open("myself/password.html?target=dialog", "login", "<@t.page 'user.new_password'/>", {mask: true, width: 450, height: 320});
                </@sys.authorized>
            </#if>
                $('#navMenu li a[parentId=${parentId!0}]').parent().addClass("selected");
                loadScripts(["${base}/resource/js/echarts.common.min.js"],function(){
                    echartsProxy(echarts);
                });
            }
        });
    </script>
</body>
</html>